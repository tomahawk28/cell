<!DOCTYPE html>
<html>
<head>
<script src="/static/1.11.1/jquery.min.js"></script>
<script>

var retryMills = 500
var loadCompleted = false
var refresh_screen_uri = "/refresh_screen"

function checkLoadStatus(retry){
    if (loadCompleted){
        loadCompleted=false
        setTimeout(ScreenAjaxRequest,retryMills);
    }else if (retry>0){
       setTimeout(function() {
                checkLoadStatus(retry-1);
                }, 400);
       if(typeof(console)!=undefined){
           console.log("image load waiting: " + retry )
       }
    }else{
        //retry dried out
       if(typeof(console)!=undefined){
        console.log("image load faild: " + retry )
       }
        alert("Check your network connection!")
    }
    
}

function completeStatus(){
    loadCompleted = true
}

var ScreenAjaxRequest = function () {
	$(".cell").each(function(i){
		img = $(this)
		$.ajax({
			url: refresh_screen_uri,
			timeout: 8000
		}).fail(function(jqXHR, textStatus, errorThrown){
			if(textStatus=="timeout"){
				$("#info").html("Poor network connection")
				setTimeout(ScreenAjaxRequest,retryMills*1.5);
			}else{
				alert("Connection failed, Try again:")
			}
		}).done(function(data){
			if (data != null && data.length > 0) {
				$("#info").html("")
                $(img).attr("src", "/screen?date="+new Date().getTime());
			}
            checkLoadStatus(40)
		});
	});
};





$(document).ready(function() {
	  $(".cell").each(function(i){
		 $(this).click(function(e) {
			var offset = $(this).offset();
			x= e.pageX - offset.left
			y= e.pageY - offset.top
			x= parseInt(x*1.33)
			y= parseInt(y*1.33)
			 $.get("/touch?x="+x+"&y="+y,
			 function(data,status){
             if(typeof(console)!=undefined){
                 console.log("Status: " + status);
             }
			});
		});
	 });
	 
	 $(".keyp").each(function(i){
		 $(this).click(function(e) {
			$.ajax({
				url: "/keyp",
				type: 'POST',
				data: {value: $(this).attr("value")},
				success: function (result){
				}
			});
		});
	 });
	 
	 ScreenAjaxRequest ();
});


</script>
</head>
<body>
<ul>
   
		<style type="text/css">
	.tg  {border-collapse:collapse;border-spacing:0;}
	.tg td{font-family:Arial, sans-serif;font-size:14px;padding:10px 5px;border-style:solid;border-width:1px;overflow:hidden;word-break:normal;text-align:center;}
	.tg th{font-family:Arial, sans-serif;font-size:14px;font-weight:normal;padding:10px 5px;border-style:solid;border-width:1px;overflow:hidden;word-break:normal;}
	.keyp {width: 80px;border-width: 2;}
	</style>
	<div id="info" class="info-box alert"></div>
	<table>
	<tr><td>
	<table class="tg">
	  <tr>
		<th class="tg-031e" colspan="6" rowspan="9" style="padding-bottom:0px; padding-top:0px">
		<img class="cell" width="600" height="450" onload="completeStatus()"/>
		</th>
		<th class="tg-031e"><button class="keyp" value="ESC">ESC</button></th>
	  </tr>
	  <tr>
		<td class="tg-031e"></td>
	  </tr>
	  <tr>
		<td class="tg-031e"></td>
	  </tr>
	  <tr>
		<td class="tg-031e"></td>
	  </tr>
	  <tr>
		<td class="tg-031e"></td>
	  </tr>
	  <tr>
		<td class="tg-031e"></td>
	  </tr>
	  <tr>
		<td class="tg-031e"></td>
	  </tr>
	  <tr>
		<td class="tg-031e"></td>
	  </tr>
	  <tr>
		<td class="tg-031e"><button class="keyp" value="PREV">Prev</button></td>
	  </tr>
	  <tr>
			<td class="tg-031e"><button class="keyp" value="MODE">Mode</button></td>
			<td class="tg-031e"><button class="keyp" value="FREQ">Freq/Dist</button></td>
			<td class="tg-031e"><button class="keyp" value="AMP">Amp/Scale</button></td>
			<td class="tg-031e"><button class="keyp" value="BW">BW/AVG</button></td>
			<td class="tg-031e"><button class="keyp" value="TRACE">Trace/ Display</button></td>
			<td class="tg-031e"><button class="keyp" value="MARK">Marker</button></td>
			<td class="tg-031e"><button class="keyp" value="PEAK">Peak Search</button></td>
		  </tr>
	</table>
	</td><td>
		
<table class="tg">
  <tr>
    <th class="tg-031e"><button class="keyp numkey" value="NUM1">Measure<br/> 1</button></th>
    <th class="tg-031e"><button class="keyp numkey" value="NUM2">Trigger<br/> 2</button></th>
    <th class="tg-031e"><button class="keyp numkey" value="NUM3">System<br/> 3</button></th>
  </tr>
  <tr>
    <td class="tg-031e"><button class="keyp numkey" value="NUM4">Measure Setup</br>4</button></td>
    <td class="tg-031e"><button class="keyp numkey" value="NUM5">5</button></td>
    <td class="tg-031e"><button class="keyp numkey" value="NUM6">Preset<br/>6</button></td>
  </tr>
  <tr>
    <td class="tg-031e"><button class="keyp numkey" value="NUM7">Save/Load<br/>7</button></td>
    <td class="tg-031e"><button class="keyp numkey" value="NUM8">Bright<br/>8</button></td>
    <td class="tg-031e"><button class="keyp numkey" value="NUM9">Hold<br/>9</button></td>
  </tr>
  <tr>
    <td class="tg-031e"><button class="keyp numkey" value="JUM">Sweep<br/>.</button></td>
    <td class="tg-031e"><button class="keyp numkey" value="NUM0">Help<br/>0</button></td>
    <td class="tg-031e"><button class="keyp numkey" value="BUHO">Limit<br/>+/-</button></td>
  </tr>
  <tr>
    <td class="tg-031e"><button class="keyp" value="DEL" style="width:40px">Del</button></td>
    <td class="tg-031e" colspan="2"><button class="keyp" value="ENTER">Enter</button></td>
  </tr>
</table>
</td></tr>
</table>
</ul>
</body>
</html>
